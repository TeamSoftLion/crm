generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MANAGER
  TEACHER
  STUDENT
}

enum DayOfWeek {
  MON
  TUE
  WED
  THU
  FRI
  SAT
  SUN
}

model User {
  id               String   @id @default(cuid())
  firstName        String
  lastName         String
  phone            String   @unique
  passwordHash     String
  role             Role     @default(STUDENT)
  isActive         Boolean  @default(true)
  refreshTokenHash String?
  createdAt        DateTime @default(now())

  // üîÅ back-relations (har biri optional ‚Äî 1:1)
  teacherProfile TeacherProfile?
  studentProfile StudentProfile?
  managerProfile ManagerProfile?

  @@index([role])
  @@index([isActive])
}

model ManagerProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  photoUrl      String?
  monthlySalary Decimal @db.Decimal(10, 2)
}

model TeacherProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  photoUrl      String?
  monthlySalary Decimal? @db.Decimal(10, 2)
  percentShare  Decimal? @db.Decimal(5, 2) // 0..100
}

model StudentProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  dateOfBirth DateTime?
  startDate   DateTime?

  groupId String?
  group   Group?  @relation(fields: [groupId], references: [id])
}

model Room {
  id        String   @id @default(cuid())
  name      String   @unique
  location  String?
  capacity  Int? @default(10)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  groups Group[]
}

model Group {
  id        String   @id @default(cuid())
  name      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  roomId    String?
  room      Room?    @relation(fields: [roomId], references: [id])
  capacity  Int
  students  StudentProfile[]
  schedule  GroupSchedule[]
}


model GroupSchedule {
  id        String    @id @default(cuid())
  day       DayOfWeek
  startTime String // "HH:mm"
  endTime   String // "HH:mm"
  groupId   String
  group     Group     @relation(fields: [groupId], references: [id])
  createdAt DateTime  @default(now())

  @@unique([groupId, day])
}
